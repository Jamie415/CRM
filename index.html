<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple CRM - Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb;
            height: 100vh;
            overflow: hidden;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 3rem;
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 420px;
        }

        .login-box h1 {
            font-size: 2rem;
            color: #111827;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-box p {
            color: #6b7280;
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-box input {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }

        .login-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-box button {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-box button:hover {
            transform: translateY(-2px);
        }

        .login-box button:active {
            transform: translateY(0);
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .password-hint {
            background-color: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: #92400e;
        }

        .password-hint strong {
            display: block;
            margin-bottom: 0.5rem;
            color: #78350f;
        }

        .password-hint code {
            background-color: #fef9c3;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: monospace;
        }

        /* Main App (hidden until logged in) */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: flex;
            height: 100vh;
        }

        .logout-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            z-index: 1000;
        }

        .logout-btn:hover {
            background-color: #dc2626;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .header-top h1 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #111827;
        }

        .btn-add {
            padding: 0.5rem;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-add:hover {
            background-color: #1d4ed8;
        }

        .search-box {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .search-box input {
            width: 100%;
            padding: 0.5rem 0.5rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .contacts-list {
            flex: 1;
            overflow-y: auto;
        }

        .contact-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
        }

        .contact-item:hover {
            background-color: #f9fafb;
        }

        .contact-item.active {
            background-color: #dbeafe;
        }

        .contact-name {
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.25rem;
        }

        .contact-company {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .contact-stage {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            font-size: 0.75rem;
            text-transform: capitalize;
        }

        .empty-state {
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .contact-header {
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .contact-info h2 {
            font-size: 1.875rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 0.5rem;
        }

        .contact-details {
            display: flex;
            gap: 1.5rem;
            color: #6b7280;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.875rem;
        }

        .stage-badge {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            background-color: #dbeafe;
            color: #1e40af;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.5rem;
            text-transform: capitalize;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-edit {
            background-color: #f3f4f6;
            color: #374151;
        }

        .btn-edit:hover {
            background-color: #e5e7eb;
        }

        .btn-delete {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .btn-delete:hover {
            background-color: #fecaca;
        }

        .btn-save {
            background-color: #10b981;
            color: white;
        }

        .btn-save:hover {
            background-color: #059669;
        }

        .btn-cancel {
            background-color: #d1d5db;
            color: #374151;
        }

        .btn-cancel:hover {
            background-color: #9ca3af;
        }

        .edit-form input,
        .edit-form select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
        }

        .edit-form input:focus,
        .edit-form select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .edit-form input[type="text"]:first-child {
            font-size: 1.875rem;
            font-weight: bold;
        }

        /* Tabs */
        .tabs {
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            gap: 2rem;
            padding: 0 2rem;
        }

        .tab {
            padding: 0.75rem 0.25rem;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            font-size: 0.875rem;
            color: #6b7280;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .tab:hover {
            color: #374151;
        }

        .tab.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
        }

        /* Tab Content */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .btn-primary {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-success {
            background-color: #10b981;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-purple {
            background-color: #8b5cf6;
        }

        .btn-purple:hover {
            background-color: #7c3aed;
        }

        .activity-list,
        .deal-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .activity-item,
        .deal-item {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .activity-header,
        .deal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .activity-type {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .activity-date,
        .deal-date {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .activity-item textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            resize: vertical;
            min-height: 60px;
        }

        .deal-item input[type="text"] {
            font-size: 1.125rem;
            font-weight: 600;
            width: 100%;
            padding: 0.25rem;
            border: none;
            border-bottom: 1px solid transparent;
            margin-bottom: 0.75rem;
        }

        .deal-item input[type="text"]:hover {
            border-bottom-color: #d1d5db;
        }

        .deal-item input[type="text"]:focus {
            outline: none;
            border-bottom-color: #2563eb;
        }

        .deal-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .deal-value input {
            width: 120px;
            padding: 0.375rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }

        .deal-stage select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            text-transform: capitalize;
        }

        .notes-area {
            width: 100%;
            height: 400px;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            resize: vertical;
        }

        .notes-area:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6b7280;
        }

        .placeholder svg {
            margin-bottom: 1rem;
            color: #9ca3af;
        }

        /* Icons */
        .icon {
            width: 20px;
            height: 20px;
        }

        .icon-sm {
            width: 16px;
            height: 16px;
        }

        .icon-lg {
            width: 48px;
            height: 48px;
        }

        /* Colors for activity types */
        .activity-call { color: #2563eb; }
        .activity-email { color: #10b981; }
        .activity-meeting { color: #8b5cf6; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>üîê CRM Login</h1>
            <p>Enter password to access your CRM</p>
            <form onsubmit="handleLogin(event)">
                <input 
                    type="password" 
                    id="passwordInput" 
                    placeholder="Enter password"
                    autocomplete="current-password"
                    required
                >
                <div class="error-message" id="errorMessage"></div>
                <button type="submit">Login</button>
            </form>
            <div class="password-hint">
                <strong>‚ö†Ô∏è IMPORTANT - Change Password Before Sharing!</strong>
                Open this HTML file in a text editor and find this line (around line 712):<br>
                <code>const CORRECT_PASSWORD = 'elevation#2026';</code><br><br>
                Change <code>'crm2024'</code> to your own password, save, then upload to your hosting.<br><br>
                Current password for testing: <strong>crm2024</strong>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <button class="logout-btn" onclick="logout()">Logout</button>
        
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="header-top">
                    <h1>Simple CRM</h1>
                    <button class="btn-add" onclick="addContact()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                    </button>
                </div>
                <div class="search-box">
                    <svg class="search-icon icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" id="searchInput" placeholder="Search contacts..." oninput="filterContacts()">
                </div>
            </div>
            <div class="contacts-list" id="contactsList"></div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="placeholder">
                <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <p>Select a contact to view details</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // PASSWORD CONFIGURATION
        // ============================================
        // CHANGE THIS PASSWORD BEFORE DEPLOYING!
        // Replace 'crm2024' with your own secure password
        const CORRECT_PASSWORD = 'crm2024';
        // ============================================

        // Login functionality
        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('passwordInput').value;
            const errorMessage = document.getElementById('errorMessage');

            if (password === CORRECT_PASSWORD) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').classList.add('active');
                sessionStorage.setItem('crm-authenticated', 'true');
                initializeApp();
            } else {
                errorMessage.textContent = 'Incorrect password. Please try again.';
            }
        }

        function logout() {
            sessionStorage.removeItem('crm-authenticated');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('passwordInput').value = '';
            document.getElementById('errorMessage').textContent = '';
        }

        // Check if already authenticated
        if (sessionStorage.getItem('crm-authenticated') === 'true') {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            initializeApp();
        }

        // Data storage
        let contacts = [];
        let activities = [];
        let deals = [];
        let selectedContactId = null;
        let isEditing = false;
        let activeTab = 'activities';

        const stages = ['lead', 'qualified', 'proposal', 'negotiation', 'closed-won', 'closed-lost'];
        const dealStages = ['prospect', 'qualified', 'proposal', 'negotiation', 'closed-won', 'closed-lost'];

        function initializeApp() {
            contacts = JSON.parse(localStorage.getItem('crm-contacts') || '[]');
            activities = JSON.parse(localStorage.getItem('crm-activities') || '[]');
            deals = JSON.parse(localStorage.getItem('crm-deals') || '[]');
            renderContactsList();
            renderContactDetail();
        }

        // Save functions
        function saveContacts() {
            localStorage.setItem('crm-contacts', JSON.stringify(contacts));
        }

        function saveActivities() {
            localStorage.setItem('crm-activities', JSON.stringify(activities));
        }

        function saveDeals() {
            localStorage.setItem('crm-deals', JSON.stringify(deals));
        }

        // Render functions
        function renderContactsList() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredContacts = contacts.filter(c =>
                c.name.toLowerCase().includes(searchTerm) ||
                c.company.toLowerCase().includes(searchTerm) ||
                c.email.toLowerCase().includes(searchTerm)
            );

            const listEl = document.getElementById('contactsList');
            
            if (filteredContacts.length === 0) {
                listEl.innerHTML = '<div class="empty-state">No contacts yet. Click + to add one.</div>';
                return;
            }

            listEl.innerHTML = filteredContacts.map(contact => `
                <div class="contact-item ${selectedContactId === contact.id ? 'active' : ''}" 
                     onclick="selectContact('${contact.id}')">
                    <div class="contact-name">${contact.name}</div>
                    <div class="contact-company">${contact.company || ''}</div>
                    <span class="contact-stage">${contact.stage}</span>
                </div>
            `).join('');
        }

        function renderContactDetail() {
            const contact = contacts.find(c => c.id === selectedContactId);
            if (!contact) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="placeholder">
                        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <p>Select a contact to view details</p>
                    </div>
                `;
                return;
            }

            if (isEditing) {
                renderEditForm(contact);
            } else {
                renderViewMode(contact);
            }
        }

        function renderViewMode(contact) {
            document.getElementById('mainContent').innerHTML = `
                <div class="contact-header">
                    <div class="header-content">
                        <div class="contact-info">
                            <h2>${contact.name}</h2>
                            <div class="contact-details">
                                ${contact.company ? `
                                    <div class="detail-item">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                        </svg>
                                        <span>${contact.company}</span>
                                    </div>
                                ` : ''}
                                ${contact.email ? `
                                    <div class="detail-item">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                        </svg>
                                        <span>${contact.email}</span>
                                    </div>
                                ` : ''}
                                ${contact.phone ? `
                                    <div class="detail-item">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                        </svg>
                                        <span>${contact.phone}</span>
                                    </div>
                                ` : ''}
                            </div>
                            <span class="stage-badge">${contact.stage}</span>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-edit" onclick="startEdit()">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="btn btn-delete" onclick="deleteContact('${contact.id}')">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="tabs">
                    <button class="tab ${activeTab === 'activities' ? 'active' : ''}" onclick="switchTab('activities')">Activities</button>
                    <button class="tab ${activeTab === 'deals' ? 'active' : ''}" onclick="switchTab('deals')">Deals</button>
                    <button class="tab ${activeTab === 'notes' ? 'active' : ''}" onclick="switchTab('notes')">Notes</button>
                </div>
                <div class="tab-content" id="tabContent"></div>
            `;

            renderTabContent();
        }

        function renderEditForm(contact) {
            document.getElementById('mainContent').innerHTML = `
                <div class="contact-header">
                    <div class="header-content">
                        <div class="contact-info edit-form">
                            <input type="text" id="editName" value="${contact.name}" placeholder="Name">
                            <input type="text" id="editCompany" value="${contact.company || ''}" placeholder="Company">
                            <input type="email" id="editEmail" value="${contact.email || ''}" placeholder="Email">
                            <input type="tel" id="editPhone" value="${contact.phone || ''}" placeholder="Phone">
                            <select id="editStage">
                                ${stages.map(stage => `
                                    <option value="${stage}" ${contact.stage === stage ? 'selected' : ''}>${stage}</option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-save" onclick="saveEdit()">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                            </button>
                            <button class="btn btn-cancel" onclick="cancelEdit()">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTabContent() {
            const contact = contacts.find(c => c.id === selectedContactId);
            if (!contact) return;

            const tabContentEl = document.getElementById('tabContent');

            if (activeTab === 'activities') {
                const contactActivities = activities.filter(a => a.contactId === selectedContactId);
                tabContentEl.innerHTML = `
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="addActivity('call')">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            Log Call
                        </button>
                        <button class="btn-primary btn-success" onclick="addActivity('email')">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            Log Email
                        </button>
                        <button class="btn-primary btn-purple" onclick="addActivity('meeting')">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Log Meeting
                        </button>
                    </div>
                    <div class="activity-list">
                        ${contactActivities.length === 0 ? '<div class="empty-state">No activities logged yet</div>' : 
                            contactActivities.map(activity => `
                                <div class="activity-item">
                                    <div class="activity-header">
                                        <div class="activity-type activity-${activity.type}">
                                            ${getActivityIcon(activity.type)}
                                            <span>${activity.type}</span>
                                        </div>
                                        <span class="activity-date">${new Date(activity.date).toLocaleDateString()}</span>
                                    </div>
                                    <textarea 
                                        placeholder="Add notes about this activity..."
                                        onchange="updateActivity('${activity.id}', this.value)"
                                    >${activity.description}</textarea>
                                </div>
                            `).join('')
                        }
                    </div>
                `;
            } else if (activeTab === 'deals') {
                const contactDeals = deals.filter(d => d.contactId === selectedContactId);
                tabContentEl.innerHTML = `
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="addDeal()">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Add Deal
                        </button>
                    </div>
                    <div class="deal-list">
                        ${contactDeals.length === 0 ? '<div class="empty-state">No deals yet</div>' : 
                            contactDeals.map(deal => `
                                <div class="deal-item">
                                    <input type="text" value="${deal.title}" onchange="updateDealTitle('${deal.id}', this.value)">
                                    <div class="deal-value">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        <input type="number" value="${deal.value}" onchange="updateDealValue('${deal.id}', this.value)">
                                    </div>
                                    <div class="deal-stage">
                                        <select onchange="updateDealStage('${deal.id}', this.value)">
                                            ${dealStages.map(stage => `
                                                <option value="${stage}" ${deal.stage === stage ? 'selected' : ''}>${stage}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                `;
            } else if (activeTab === 'notes') {
                tabContentEl.innerHTML = `
                    <textarea 
                        class="notes-area" 
                        placeholder="Add notes about this contact..."
                        onchange="updateNotes(this.value)"
                    >${contact.notes || ''}</textarea>
                `;
            }
        }

        function getActivityIcon(type) {
            const icons = {
                call: '<svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>',
                email: '<svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>',
                meeting: '<svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>'
            };
            return icons[type] || '';
        }

        // Action functions
        function addContact() {
            const newContact = {
                id: Date.now().toString(),
                name: 'New Contact',
                company: '',
                email: '',
                phone: '',
                stage: 'lead',
                notes: '',
                createdAt: new Date().toISOString()
            };
            contacts.push(newContact);
            saveContacts();
            selectedContactId = newContact.id;
            isEditing = true;
            renderContactsList();
            renderContactDetail();
        }

        function selectContact(id) {
            selectedContactId = id;
            isEditing = false;
            activeTab = 'activities';
            renderContactsList();
            renderContactDetail();
        }

        function startEdit() {
            isEditing = true;
            renderContactDetail();
        }

        function saveEdit() {
            const contact = contacts.find(c => c.id === selectedContactId);
            if (contact) {
                contact.name = document.getElementById('editName').value;
                contact.company = document.getElementById('editCompany').value;
                contact.email = document.getElementById('editEmail').value;
                contact.phone = document.getElementById('editPhone').value;
                contact.stage = document.getElementById('editStage').value;
                saveContacts();
                isEditing = false;
                renderContactsList();
                renderContactDetail();
            }
        }

        function cancelEdit() {
            isEditing = false;
            renderContactDetail();
        }

        function deleteContact(id) {
            if (confirm('Delete this contact?')) {
                contacts = contacts.filter(c => c.id !== id);
                activities = activities.filter(a => a.contactId !== id);
                deals = deals.filter(d => d.contactId !== id);
                saveContacts();
                saveActivities();
                saveDeals();
                selectedContactId = null;
                renderContactsList();
                renderContactDetail();
            }
        }

        function filterContacts() {
            renderContactsList();
        }

        function switchTab(tab) {
            activeTab = tab;
            renderContactDetail();
        }

        function addActivity(type) {
            const newActivity = {
                id: Date.now().toString(),
                contactId: selectedContactId,
                type: type,
                description: '',
                date: new Date().toISOString()
            };
            activities.unshift(newActivity);
            saveActivities();
            renderTabContent();
        }

        function updateActivity(id, description) {
            const activity = activities.find(a => a.id === id);
            if (activity) {
                activity.description = description;
                saveActivities();
            }
        }

        function addDeal() {
            const newDeal = {
                id: Date.now().toString(),
                contactId: selectedContactId,
                title: 'New Deal',
                value: 0,
                stage: 'prospect',
                createdAt: new Date().toISOString()
            };
            deals.push(newDeal);
            saveDeals();
            renderTabContent();
        }

        function updateDealTitle(id, title) {
            const deal = deals.find(d => d.id === id);
            if (deal) {
                deal.title = title;
                saveDeals();
            }
        }

        function updateDealValue(id, value) {
            const deal = deals.find(d => d.id === id);
            if (deal) {
                deal.value = parseFloat(value) || 0;
                saveDeals();
            }
        }

        function updateDealStage(id, stage) {
            const deal = deals.find(d => d.id === id);
            if (deal) {
                deal.stage = stage;
                saveDeals();
            }
        }

        function updateNotes(notes) {
            const contact = contacts.find(c => c.id === selectedContactId);
            if (contact) {
                contact.notes = notes;
                saveContacts();
            }
        }
    </script>
</body>
</html>
